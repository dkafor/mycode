---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env:
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTENT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVSlI5VHdtRHUwL1YvcnphZVRzTGNqbzk5WXFNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTWpBd05ERXpNakF3TlRBd1doY05NakV3TkRFek1qQXcKTlRBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUURGeE5PMHlFU3pJU0draE9jSzNsalVNb2ltQ3J6SFBWMHJhYyt0eDYwTDFGU0xMcFMzMWpLbQpsY2E0WWROdmtGYlh3bW10NUpnTFExVTNXM2RmZU8xNHU3R1B6dUtQZ1ErVVU5R0ZraEhuVVZLNDlwQ2NvRkY0CklneC8xUFQxN3hmK0NTN1gyQzFEUWZCeTJhcjBYeXZSbUt2MVp1Ynd0dEZ2Z0w4ZWxwcWgzcjBiQ0xIRHpWanQKWHFhc0hmK20xYkJuRmRPNlpWN0twRWM5b0lxTDBLZHdKeEpUanVlVG5OcndSRnNEaGRVWmhhWm5paEk5akF5YQo2MVlydHFQM0hCSGZ0dXdIVmtKVzJrTnBKTWlIbkx6TFJXQTBjUlB1NmFZUDNBVjVPOVRCZmd2K0FHTGJmMmRVCk5GMFBQL3c4ejBsbm5Ybm04SEx0alhYVnlieTNndXd2QWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlRkRGxJbHJaUHRqcGhVdmRwUFBKUnJ4WXJ4ZWpBZkJnTlZIU01FR0RBV2dCUThXaFdzCk0rd3QyTytHMW9hb0lraUdaUmxOS0RBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBSW8rWnVVWjh5NDQ2YnI1bDZTdTBoZzY4RENxTWxwNzJwWm1kbzY2Q2FYYwo3bVZ2Szl5eER0Um1JSnhsTzdWNTFVWGdhaTVxZlpvRTc4UXhBWE0ra2diT2k5YjZTakN5OG1mNE5KUWZzQkl1Cko3UFBOY1V4U29BQStaampoRUxjUjFZWW5TUW1ldGtQNTdRbWYxdlMrZHZQSHh5dUo5dHJ1b1l4Vmo1OG1ZNEEKWHZrZjJCOFFDWWs5RDh3UnJ1SWJoTFVJd0RBNUVDN0VMbCsvSllyaHRRY3NucnZFdmpwSXdhdnZ2elk3VmFPSwpVSlJQVFFpODVSd21wTThxWllVbjhrL083ZVlKWkZsZ2E3N05wRCt0QWdDZWlyN3Mra1Jzbmg1NlJSMW1mVnp6Cjh3TUw2NUxzYzVhamxDSE15MzF2bWNxS3cwZG9CYUdqb0RmcE5RWWZXazg9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBeGNUVHRNaEVzeUVocElUbkN0NVkxREtJcGdxOHh6MWRLMm5QcmNldEM5UlVpeTZVCnQ5WXlwcFhHdUdIVGI1QlcxOEpwcmVTWUMwTlZOMXQzWDNqdGVMdXhqODdpajRFUGxGUFJoWklSNTFGU3VQYVEKbktCUmVDSU1mOVQwOWU4WC9na3UxOWd0UTBId2N0bXE5RjhyMFppcjlXYm04TGJSYjRDL0hwYWFvZDY5R3dpeAp3ODFZN1Y2bXJCMy9wdFd3WnhYVHVtVmV5cVJIUGFDS2k5Q25jQ2NTVTQ3bms1emE4RVJiQTRYVkdZV21aNG9TClBZd01tdXRXSzdhajl4d1IzN2JzQjFaQ1Z0cERhU1RJaDV5OHkwVmdOSEVUN3VtbUQ5d0ZlVHZVd1g0TC9nQmkKMjM5blZEUmREei84UE05Slo1MTU1dkJ5N1kxMTFjbTh0NExzTHdJREFRQUJBb0lCQUd5cHhnelowTzEvY2NXOApoRm56YTJsRVR0SzBxWjdyZDRySCs2VW5Sa3h1b1BsTVljaFV0OFhTRzdycGZVd2FTYTBKRkJuSXRVWFMvRHFMClZoNnVDZ1RCVkVHSTBmRTVYMzhIUXVNYUxCNG1EOGF6S3lmejZtK1FmYityR2VFYk90cUkzeVVYa1Y4WUZ1NXoKN0x1U296ZnBvK29WWFNTN3ZuMStod1JlaVo0UUZiS09XSERsL2VQYmxqa29jUlFjcUlTWGJUN0lqYWxCOW9YNQpTZnNMWUdjNHc3dGpkcldJZFY1QjRBRy9XaU0vdEVsb3lKa0FjVU9UU2ZUYnlVWG9TdjYzWVVhYTFOdWlrM24zClB5NEhQcm10djhEa0dFYlRiRVdwRUZhU0J0dDZVTXNJRG41d2xaRmVpY2dkUmpqUGFxU1p0SU1UZGJVSElpdnkKcVcxcXV1RUNnWUVBN3NSbzBzNGQ3SHMyaWE5Z0pZZlBRSzhYcStGR0xaQXFtNWdTaFVYazE3SFkrc0NnSHVhTQpiNzl0RnZrb0I3Wk96OFF1WHMyUGoxdWhacDVIM3hKNFlTT2dnWmh0SmUvdWQ1UFpzS0cveDdoSGFtUGxZbjFGCmhIZ0J3RFdod0VhY1dFR3RVZ2RLckxRNG1vSmVOMHlkUjM3U3VDWWRQZllJOG9NYXpmSkthaEVDZ1lFQTFBcm8KNTdkMzZJaUd3SW9RTmtTNGY5a1lJSkVSOXowcVQ0REpZSEt0MEo3bEVzWXBSWTB2Ui9IWnQzVERISEk1SDdNdQozcEpBdy9FN1EvSkNVK1pJNWRQQWVtcEdTRmR0UDlGdlY4SlQ0SHh4QUJqbjBtSEw2K1ZTRll4L2xtdTYvV1pzCmFDS1h5bGdRamI2aDlCblorOHVSOTNrUVNPUVBmZTc3dENkRHNqOENnWUVBcVk1NUVocWxUV1pDV0l4ZUxzaSsKK1NSZUh3VWZIUVFmL2RhRWNIZ3VCcTZaYzVpUEhPS0VJR2RFUk9neThTY1oySmxzaEk1ZHdHUkZ2ZVh4REF6Rgp4OVhSQ2JjQTY4dnpBSi9TRzRrQjlBWjlVS1FZSlZUb3BTWER1SWRka25tU1ZXcHVkcTRPN1k0ZUZEczRSUFQzClMrcFlJY1dQUm8wTjFZb2M0dHVJMU1FQ2dZRUFpNnpNRXFiMkk0U2JUd1VpL0x4ejFET0xBeGpNZnRJWnB0a3MKelkxOUZXazFlQkowYVU1QkVPRXRDdjJzOEhZRlR1NVhOMkdicS9haGxYWmxYcUxZN2h0NE5Lc0F0UEp5RXBIQgpDRXdIdUY0QWlaSGVVdVQ4ME56MEh5RzNnYnhoSmo1cnRvVGkrL1Rhb3FRcVJvTW81Z1lJbHIxMmpxMDd6emEzCk1zcVNlejBDZ1lBNytqNld1V0VPNG1Xa0Zrc2J0cUV3RGgweE9BMEVmK3VKT0ZzUHR1MHovZE56YTVjZERvR04KMFhBVEJNZkJIbVFJV2EyRVA0OUtGWSsvcmdveGRwaWRJZnphQ0hsRy95WmU1YWFVUmdWVk0yUTBBZWlWdFZUVQpneG12UnZBcVlGVlpXUXlBT21pamhmMkRoYnRONklLc0lMaU1iUktEVS9uSk9naVdtanA4RFE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
metadata:
  name: registry-tls
  namespace: default
type: Opaque
